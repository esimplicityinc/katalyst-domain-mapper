---
id: US-051
title: Map Capabilities to Organizational Nodes
actor: Platform Architect
goal: Map system capabilities to specific nodes in the taxonomy to track capability ownership and implementation
benefit: Enables capability-based analysis, ownership tracking, and identifies capability gaps or duplication
capability: CAP-013
status: planned
priority: high
roadmapItems:
  - ROAD-041
relatedStories:
  - US-049
  - US-050
created: 2026-02-17
updated: 2026-02-17
---

# US-051: Map Capabilities to Organizational Nodes

## Story

**As a** Platform Architect  
**I want to** map system capabilities to specific nodes in the taxonomy  
**So that** I can track which systems own which capabilities and identify gaps or duplication

## Acceptance Criteria

### Creating Capability Mappings

- [ ] Can create a new capability with name, category, and description
- [ ] Can assign capability to one or more nodes
- [ ] Can specify capability category (e.g., "authentication", "data-processing", "notification")
- [ ] System enforces unique capability names
- [ ] System validates that all target nodes exist

### Creating Capability Relationships

- [ ] Can define relationships between capabilities (depends-on, provides-to, extends)
- [ ] Can specify relationship type and description
- [ ] System prevents circular dependencies
- [ ] System validates that both source and target capabilities exist
- [ ] Can view full dependency graph for a capability

### Updating Capability Mappings

- [ ] Can update capability name, category, and description
- [ ] Can add or remove node assignments
- [ ] Can modify capability relationships
- [ ] Changes are reflected in all related nodes and capabilities

### Deleting Capability Mappings

- [ ] Can delete a capability with no relationships
- [ ] System blocks deletion if capability has dependencies (other capabilities depend on it)
- [ ] System provides list of blocking relationships
- [ ] Can cascade delete all relationships if explicitly confirmed

### Querying Capabilities

- [ ] Can list all capabilities with filtering by category
- [ ] Can retrieve capability by ID with all node assignments
- [ ] Can fetch all capabilities for a specific node
- [ ] Can view capability dependency graph
- [ ] Can search capabilities by name or category
- [ ] Can identify orphaned capabilities (not assigned to any node)
- [ ] Can identify duplicate capabilities (same name/category across different nodes)

## Implementation Notes

### API Endpoints (10 total)

#### Capabilities (5)
1. `POST /api/v1/taxonomy/capabilities` - Create capability
2. `GET /api/v1/taxonomy/capabilities` - List capabilities (with filters)
3. `GET /api/v1/taxonomy/capabilities/:id` - Get capability details
4. `PATCH /api/v1/taxonomy/capabilities/:id` - Update capability
5. `DELETE /api/v1/taxonomy/capabilities/:id` - Delete capability

#### Capability Relationships (5)
6. `POST /api/v1/taxonomy/capability-relationships` - Create relationship
7. `GET /api/v1/taxonomy/capability-relationships` - List relationships
8. `GET /api/v1/taxonomy/capability-relationships/:id` - Get relationship details
9. `PATCH /api/v1/taxonomy/capability-relationships/:id` - Update relationship
10. `DELETE /api/v1/taxonomy/capability-relationships/:id` - Delete relationship

### Port Interface Methods

```typescript
// From TaxonomyRepository port

// Capabilities
createCapability(capability: Capability): Promise<Capability>
getCapabilityById(id: string): Promise<Capability | null>
getAllCapabilities(filters?: CapabilityFilters): Promise<Capability[]>
updateCapability(id: string, updates: Partial<Capability>): Promise<Capability>
deleteCapability(id: string, cascade?: boolean): Promise<void>
getCapabilitiesForNode(nodeId: string): Promise<Capability[]>
getNodesForCapability(capabilityId: string): Promise<TaxonomyNode[]>

// Capability Relationships
createCapabilityRelationship(rel: CapabilityRelationship): Promise<CapabilityRelationship>
getCapabilityRelationshipById(id: string): Promise<CapabilityRelationship | null>
getAllCapabilityRelationships(): Promise<CapabilityRelationship[]>
updateCapabilityRelationship(id: string, updates: Partial<CapabilityRelationship>): Promise<CapabilityRelationship>
deleteCapabilityRelationship(id: string): Promise<void>
getCapabilityDependencies(capabilityId: string): Promise<CapabilityRelationship[]>
validateCapabilityRelationship(sourceId: string, targetId: string): Promise<boolean>
```

### File-Based Adapter

Capabilities stored in YAML files:
```
data/taxonomy/capabilities/
  ├── user-authentication.yaml
  ├── foe-report-generation.yaml
  └── domain-visualization.yaml

data/taxonomy/capability-relationships/
  ├── rel-001-auth-depends-session.yaml
  └── rel-002-reports-provides-api.yaml
```

Capability file format:
```yaml
id: cap-001
name: User Authentication
category: security
description: Authenticate users via OAuth2 and JWT tokens
nodeAssignments:
  - node-001  # Katalyst Identity Service
  - node-015  # API Gateway
createdAt: 2026-02-17T10:00:00Z
updatedAt: 2026-02-17T10:00:00Z
```

Relationship file format:
```yaml
id: cap-rel-001
sourceCapabilityId: cap-001  # User Authentication
targetCapabilityId: cap-010  # Session Management
relationshipType: depends-on
description: Authentication requires session management for token storage
createdAt: 2026-02-17T10:00:00Z
updatedAt: 2026-02-17T10:00:00Z
```

## UI Components

### Capability Management Page

- List view of all capabilities
- Filter by category
- Add/Edit/Delete buttons
- Search by name
- Highlight orphaned capabilities (red badge)
- Highlight duplicate capabilities (yellow badge)

### Capability Detail View

- Full capability information
- List of assigned nodes (with links)
- Dependency graph visualization
- Relationship management (add/remove)
- Edit form with validation

### Node Detail View Enhancement

- Add "Capabilities" section showing all capabilities owned by this node
- Quick-add capability button
- Remove capability button

### Capability Dependency Graph

- Interactive graph visualization using React Flow or similar
- Color-coded by category
- Clickable nodes to navigate
- Zoom/pan controls
- Export to PNG/SVG

## BDD Scenarios

```gherkin
@US-051 @CAP-013 @ROAD-041
Feature: Map Capabilities to Nodes

  Background:
    Given I am authenticated as a Platform Architect
    And the taxonomy repository is initialized
    And nodes exist:
      | id   | name                  | nodeType        |
      | n-1  | Katalyst Intelligence | subdomain       |
      | n-2  | FOE Scanner           | bounded-context |

  Scenario: Create a capability and assign to nodes
    When I create a capability with:
      | name        | FOE Report Generation       |
      | category    | analysis                    |
      | description | Generate FOE maturity reports |
      | nodes       | n-1, n-2                    |
    Then the capability is created successfully
    And the capability has a unique ID
    And the capability is assigned to nodes "Katalyst Intelligence", "FOE Scanner"

  Scenario: Prevent duplicate capability names
    Given a capability "User Authentication" exists
    When I try to create another capability "User Authentication"
    Then the creation fails with error "Capability name already exists"

  Scenario: List all capabilities for a node
    Given capabilities exist:
      | name                  | category | nodes |
      | FOE Report Generation | analysis | n-1   |
      | Domain Visualization  | analysis | n-1   |
      | User Authentication   | security | n-2   |
    When I list capabilities for node "n-1" (Katalyst Intelligence)
    Then I see 2 capabilities: "FOE Report Generation", "Domain Visualization"

  Scenario: Identify orphaned capabilities
    Given capabilities exist:
      | name                  | nodes |
      | FOE Report Generation | n-1   |
      | Orphaned Capability   |       |
    When I list all capabilities
    Then "Orphaned Capability" is marked as orphaned
    And I receive a warning: "Capability not assigned to any node"

  Scenario: Create capability dependency relationship
    Given capabilities exist:
      | id    | name                |
      | cap-1 | User Authentication |
      | cap-2 | Session Management  |
    When I create a relationship:
      | source       | cap-1       |
      | target       | cap-2       |
      | type         | depends-on  |
      | description  | Auth needs session storage |
    Then the relationship is created successfully
    And "User Authentication" depends on "Session Management"

  Scenario: Prevent circular capability dependencies
    Given capabilities and relationships exist:
      | source | target | type       |
      | cap-1  | cap-2  | depends-on |
      | cap-2  | cap-3  | depends-on |
    When I try to create a relationship:
      | source | cap-3      |
      | target | cap-1      |
      | type   | depends-on |
    Then the creation fails with error "Circular dependency detected"
    And the error shows cycle: cap-1 → cap-2 → cap-3 → cap-1

  Scenario: View capability dependency graph
    Given capabilities and relationships exist:
      | source              | target              | type       |
      | User Authentication | Session Management  | depends-on |
      | User Authentication | Audit Logging       | provides-to|
      | Session Management  | Redis Cache         | depends-on |
    When I view the dependency graph for "User Authentication"
    Then I see:
      | capability          | relation    |
      | Session Management  | depends-on  |
      | Audit Logging       | provides-to |
      | Redis Cache         | (indirect)  |

  Scenario: Block capability deletion with dependencies
    Given capabilities exist:
      | id    | name                |
      | cap-1 | User Authentication |
      | cap-2 | API Gateway         |
    And "API Gateway" depends on "User Authentication"
    When I try to delete capability "User Authentication"
    Then the deletion fails with error "Capability has dependencies"
    And the error lists: "API Gateway depends on this capability"

  Scenario: Cascade delete capability with relationships
    Given capabilities and relationships exist:
      | id    | name                |
      | cap-1 | User Authentication |
      | cap-2 | Session Management  |
      | cap-3 | API Gateway         |
    And relationships:
      | source | target |
      | cap-1  | cap-2  |
      | cap-3  | cap-1  |
    When I delete capability "cap-1" with cascade option
    And I confirm the cascade deletion
    Then capability "cap-1" is deleted
    And relationships referencing "cap-1" are deleted
    And capabilities "cap-2", "cap-3" remain

  Scenario: Update capability node assignments
    Given a capability "FOE Report Generation" assigned to node "n-1"
    When I update the capability to also assign node "n-2"
    Then the capability is assigned to nodes "n-1", "n-2"
    And both nodes show "FOE Report Generation" in their capabilities list

  Scenario: Remove node assignment from capability
    Given a capability "FOE Report Generation" assigned to nodes "n-1", "n-2"
    When I remove node "n-1" from the capability
    Then the capability is only assigned to node "n-2"
    And node "n-1" no longer shows "FOE Report Generation"

  Scenario: Filter capabilities by category
    Given capabilities exist:
      | name                  | category  |
      | User Authentication   | security  |
      | FOE Report Generation | analysis  |
      | Audit Logging         | security  |
    When I filter capabilities by category "security"
    Then I see 2 capabilities: "User Authentication", "Audit Logging"

  Scenario: Search capabilities by name
    Given capabilities exist:
      | name                       |
      | User Authentication        |
      | OAuth2 Authentication      |
      | FOE Report Generation      |
    When I search capabilities by "Authentication"
    Then I see 2 capabilities: "User Authentication", "OAuth2 Authentication"

  Scenario: Identify duplicate capabilities
    Given capabilities exist:
      | name                | category | nodes |
      | User Authentication | security | n-1   |
      | User Authentication | security | n-2   |
    When I run duplicate detection
    Then I see 1 duplicate: "User Authentication"
    And the system suggests consolidation
```

## Dependencies

- **CAP-013**: System Taxonomy Management
- **ROAD-041**: Taxonomy CRUD Operations (Phase 1)
- **US-049**: Add Organizational Systems (nodes must exist)

## Related Stories

- **US-049**: Add Organizational Systems to Taxonomy
- **US-050**: Define Architectural Layer Standards

## Technical Notes

### Validation Rules

1. **Name uniqueness**: Capability names should be unique (warn on duplicates, don't block)
2. **Node existence**: All assigned nodes must exist
3. **Relationship validation**: Prevent circular dependencies
4. **Cascade delete**: Requires explicit confirmation

### Relationship Types

Common relationship types:

- **depends-on**: Source capability requires target capability
- **provides-to**: Source capability provides services to target capability
- **extends**: Source capability extends/enhances target capability
- **replaces**: Source capability replaces/deprecates target capability

### Performance Considerations

- Index capabilities by `category` for fast filtering
- Index capability-node mappings by both `capabilityId` and `nodeId`
- Cache dependency graphs (recompute on relationship changes)
- Use graph database (Neo4j) for complex traversal queries (Phase 5+)

### Dual Persistence

- **SQLite adapter**: Fast queries, join operations, referential integrity
- **File adapter**: Human-readable, version-controlled YAML
- Both adapters must implement same `TaxonomyRepository` port

### Integration with FOE Scanner

The FOE scanner can use capability mappings to:
- Identify which nodes implement which capabilities
- Detect capability gaps (nodes without capabilities)
- Analyze capability distribution across layers
- Recommend capability-based refactoring

### Example Capability Categories

Common categories:

- **security**: Authentication, authorization, encryption
- **data-processing**: ETL, transformation, validation
- **notification**: Email, SMS, push notifications
- **storage**: Database, file system, cache
- **analysis**: Reporting, analytics, visualization
- **integration**: API clients, webhooks, message queues
