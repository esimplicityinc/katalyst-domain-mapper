---
id: US-045
title: "Filter and Search Aggregates in Tree View"
persona: PER-007
status: draft
capabilities:
  - CAP-010
use_cases: []
acceptance_criteria:
  - "A search input in the Aggregates view header filters aggregates by matching text against aggregate names, entity names, value object names, command names, event names, and invariant rules"
  - "A bounded context dropdown filter restricts the tree to aggregates belonging to a selected context"
  - "Artifact type filter pills allow toggling visibility based on whether an aggregate contains Commands, Events, Value Objects, or Invariants"
  - "Matching tree nodes auto-expand when search is active so hits are visible without manual expanding"
  - "Matching text is highlighted within tree node labels"
  - "Header subtitle shows filtered count: 'Showing X of Y aggregates'"
  - "A 'Clear all' button resets search and filters to show all aggregates"
  - "Filter state persists across tab switches within the same session"
  - "All filter controls render correctly in dark mode"
  - "Search input and filter pills are keyboard accessible"
---

# US-045: Filter and Search Aggregates in Tree View

**As a** Domain Architect,
**I want to** search and filter aggregates by name, bounded context, and artifact type (commands, events, value objects, invariants),
**so that** I can quickly locate specific aggregates and their internal structure in large domain models without scrolling through the entire tree.

## Context

The Aggregate Tree View (ROAD-017) displays all aggregates grouped by bounded context in a collapsible hierarchy. This works well for small models (3-5 aggregates), but becomes unwieldy for larger domain models with 10+ aggregates across multiple contexts. Users need to quickly find a specific aggregate, see which aggregates have invariants defined, or focus on a single bounded context's aggregates without visual noise from others.

This story adds a search bar and filter controls above the tree, following the same UX patterns used in the Event Flow view's sync/async filter pills (ROAD-018). The search is text-based and fuzzy, matching against all textual content within an aggregate node (name, entities, value objects, commands, events, invariants).

## Road Items

- **ROAD-033** (Aggregate Tree Filtering & Search) -- Primary implementation road item

## Acceptance Criteria

1. A debounced search input appears in the Aggregates view header area
2. Typing in the search box filters aggregates by matching against: aggregate title, root entity name, entity names, value object names, command names, event names, and invariant rule text
3. A bounded context dropdown filter shows "All Contexts" by default, with options for each context that has aggregates
4. Artifact type filter pills (Commands, Events, Value Objects, Invariants) toggle filtering to only show aggregates that contain at least one of the selected artifact type
5. When search is active, matching tree nodes auto-expand to reveal the matched content
6. Matching text within tree node labels is highlighted (bold or background color)
7. Header subtitle updates to show "Showing X of Y aggregates" when filters are active
8. A "Clear all" button appears when any filter is active, resetting all filters
9. Selecting a context in the dropdown and typing a search query compose together (AND logic)
10. Filter controls support dark mode with appropriate contrast
11. Search input is focusable via keyboard; filter pills are toggleable via Enter/Space
12. Filter state is maintained when switching away from the Aggregates tab and back
