---
id: US-052
title: "Configure Deployment Environments via API"
persona: PER-002
status: draft
capabilities:
  - CAP-013
use_cases: []
acceptance_criteria:
  - "Platform engineer can POST to /api/v1/taxonomy/environments to create an environment"
  - "Environment includes name, description, parentEnvironment, promotionTargets, templateReplacements"
  - "API validates that parentEnvironment exists (if provided)"
  - "API returns 201 Created with the full environment object"
  - "Environments can be updated via PUT /api/v1/taxonomy/environments/:name"
  - "Template replacements support variable substitution (e.g., domain, region)"
  - "Promotion targets define deployment pipeline flow"
---

# US-052: Configure Deployment Environments via API

**As a** Platform Engineer,
**I want to** configure deployment environments (dev, staging, prod) via API with promotion pipelines and template replacements,
**so that** I can manage environment-specific configuration without editing large YAML files.

## Context

Deployment environments have different configurations (domains, database URLs, feature flags). Platform engineers need to:
- Define environment hierarchy (dev → staging → prod)
- Configure promotion pipelines (which env promotes to which)
- Set template replacements for variable substitution
- Support multi-region deployments (prod-us-east, prod-eu-west)

## Road Items

- **ROAD-041** (Taxonomy CRUD Operations) — Implements environment CRUD

## Acceptance Criteria

1. Create environments via `POST /api/v1/taxonomy/environments`
2. Required fields: name
3. Optional fields: description, parentEnvironment, promotionTargets, templateReplacements
4. API validates parentEnvironment exists (if provided)
5. API returns 201 Created with full environment object
6. Environments can be updated via `PUT /api/v1/taxonomy/environments/:name`
7. Template replacements are key-value pairs (e.g., `{ "domain": "dev.katalyst.io" }`)
8. Promotion targets define deployment flow (e.g., dev → staging → prod)

## Example Request

```json
POST /api/v1/taxonomy/environments

{
  "name": "staging",
  "description": "Staging environment for QA testing",
  "parentEnvironment": "dev",
  "promotionTargets": ["prod"],
  "templateReplacements": {
    "domain": "staging.katalyst.io",
    "region": "us-east-1",
    "dbHost": "staging-db.katalyst.io"
  }
}
```

## Example Response

```json
201 Created

{
  "name": "staging",
  "description": "Staging environment for QA testing",
  "parentEnvironment": "dev",
  "promotionTargets": ["prod"],
  "templateReplacements": {
    "domain": "staging.katalyst.io",
    "region": "us-east-1",
    "dbHost": "staging-db.katalyst.io"
  }
}
```

## Environment Hierarchy Examples

**Simple:**
```
dev → staging → prod
```

**Multi-Region:**
```
dev
 └─ staging
     ├─ prod-us-east
     ├─ prod-us-west
     └─ prod-eu-west
```

## Use Cases

1. **Variable Substitution**: Replace `{{domain}}` in configs with environment-specific value
2. **Promotion Pipelines**: Deploy to staging, then promote to prod
3. **Multi-Region**: Deploy same service to multiple regions with different configs
4. **Environment Cloning**: Copy staging config to create new QA environment

## Related Stories

- **US-049** (Add Systems to Taxonomy) — Systems reference environments
- **US-053** (Define Automation Actions) — Actions target specific environments
