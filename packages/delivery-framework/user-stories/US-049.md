---
id: US-049
title: Add Organizational Systems to Taxonomy
actor: Platform Architect
goal: Add and manage organizational systems (nodes) in the taxonomy to represent the architecture landscape
benefit: Establishes the foundation for mapping capabilities, environments, and architectural relationships
capability: CAP-013
status: planned
priority: high
roadmapItems:
  - ROAD-041
relatedStories:
  - US-050
  - US-051
created: 2026-02-17
updated: 2026-02-17
---

# US-049: Add Organizational Systems to Taxonomy

## Story

**As a** Platform Architect  
**I want to** add and manage organizational systems (nodes) in the taxonomy  
**So that** I can represent the complete architecture landscape with proper hierarchy and relationships

## Acceptance Criteria

### Creating Nodes

- [ ] Can create a new node with required fields (name, nodeType, description)
- [ ] Can specify nodeType from allowed values: system, subdomain, bounded-context, layer, component
- [ ] Can set optional parent node to establish hierarchy
- [ ] Can add tags for categorization and search
- [ ] System validates unique names within the same parent scope
- [ ] System prevents circular parent-child relationships

### Updating Nodes

- [ ] Can update node name, description, and tags
- [ ] Can change node's parent (with validation)
- [ ] Cannot change nodeType after creation
- [ ] System validates all child relationships remain valid after parent change
- [ ] System prevents moving node to become its own descendant

### Deleting Nodes

- [ ] Can delete a node with no children or dependencies
- [ ] System blocks deletion if node has child nodes
- [ ] System blocks deletion if node is referenced by capabilities or environments
- [ ] System provides clear error message listing blockers
- [ ] Can cascade delete if explicitly confirmed (removes all children and references)

### Querying Nodes

- [ ] Can list all nodes with filtering by nodeType
- [ ] Can retrieve node by ID with full details
- [ ] Can fetch node hierarchy (ancestors and descendants)
- [ ] Can search nodes by name or tags
- [ ] Can view all capabilities mapped to a node

## Implementation Notes

### API Endpoints (5)

1. `POST /api/v1/taxonomy/nodes` - Create node
2. `GET /api/v1/taxonomy/nodes` - List nodes (with filters)
3. `GET /api/v1/taxonomy/nodes/:id` - Get node details
4. `PATCH /api/v1/taxonomy/nodes/:id` - Update node
5. `DELETE /api/v1/taxonomy/nodes/:id` - Delete node

### Port Interface Methods

```typescript
// From TaxonomyRepository port
createNode(node: TaxonomyNode): Promise<TaxonomyNode>
getNodeById(id: string): Promise<TaxonomyNode | null>
getAllNodes(filters?: NodeFilters): Promise<TaxonomyNode[]>
updateNode(id: string, updates: Partial<TaxonomyNode>): Promise<TaxonomyNode>
deleteNode(id: string, cascade?: boolean): Promise<void>
validateNodeHierarchy(nodeId: string, parentId: string): Promise<boolean>
```

### File-Based Adapter

Nodes stored in YAML files:
```
data/taxonomy/nodes/
  ├── system-katalyst.yaml
  ├── subdomain-intelligence.yaml
  └── bounded-context-foe-scanner.yaml
```

Each file contains:
```yaml
id: node-001
name: Katalyst Intelligence
nodeType: subdomain
parentId: node-000
description: AI-powered FOE assessment and domain mapping
tags:
  - ai
  - analysis
  - foe
createdAt: 2026-02-17T10:00:00Z
updatedAt: 2026-02-17T10:00:00Z
```

## UI Components

### Node Management Page

- Tree view of organizational hierarchy
- Add/Edit/Delete buttons per node
- Drag-and-drop to reparent nodes
- Search and filter by nodeType
- Bulk import from CSV/JSON

### Node Detail View

- Full node information
- List of child nodes
- Mapped capabilities
- Associated environments
- Edit form with validation

## BDD Scenarios

```gherkin
@US-049 @CAP-013 @ROAD-041
Feature: Manage Organizational Nodes

  Background:
    Given I am authenticated as a Platform Architect
    And the taxonomy repository is initialized

  Scenario: Create a top-level system node
    When I create a node with:
      | name        | Katalyst Platform        |
      | nodeType    | system                   |
      | description | Main platform system     |
      | tags        | platform, core           |
    Then the node is created successfully
    And the node has a unique ID
    And the node has no parent

  Scenario: Create a subdomain under a system
    Given a system node "Katalyst Platform" exists
    When I create a subdomain node "Intelligence" under "Katalyst Platform"
    Then the subdomain is created successfully
    And the subdomain's parent is "Katalyst Platform"
    And the system shows "Intelligence" as a child of "Katalyst Platform"

  Scenario: Prevent duplicate names within same parent
    Given a system node "Katalyst Platform" exists
    And a subdomain node "Intelligence" under "Katalyst Platform" exists
    When I try to create another subdomain "Intelligence" under "Katalyst Platform"
    Then the creation fails with error "Name already exists in this scope"

  Scenario: Prevent circular parent relationships
    Given nodes exist:
      | id   | name          | parent |
      | n-1  | System A      | null   |
      | n-2  | Subdomain B   | n-1    |
      | n-3  | Context C     | n-2    |
    When I try to update node "n-1" to have parent "n-3"
    Then the update fails with error "Circular dependency detected"

  Scenario: Update node description and tags
    Given a node "Intelligence" exists with description "Old description"
    When I update the node with:
      | description | New AI-powered analysis system |
      | tags        | ai, analysis, foe              |
    Then the node is updated successfully
    And the node's description is "New AI-powered analysis system"
    And the node has tags: ai, analysis, foe

  Scenario: Reparent a node to a different parent
    Given nodes exist:
      | id   | name        | parent |
      | n-1  | System A    | null   |
      | n-2  | System B    | null   |
      | n-3  | Subdomain C | n-1    |
    When I update node "n-3" to have parent "n-2"
    Then the node is reparented successfully
    And "System A" has 0 children
    And "System B" has 1 child: "Subdomain C"

  Scenario: Block deletion of node with children
    Given nodes exist:
      | id   | name        | parent |
      | n-1  | System A    | null   |
      | n-2  | Subdomain B | n-1    |
    When I try to delete node "n-1"
    Then the deletion fails with error "Cannot delete node with children"
    And the error lists: "Subdomain B"

  Scenario: Block deletion of node referenced by capabilities
    Given a node "Intelligence" exists
    And capability "CAP-001" is mapped to node "Intelligence"
    When I try to delete node "Intelligence"
    Then the deletion fails with error "Cannot delete node referenced by capabilities"
    And the error lists: "CAP-001"

  Scenario: Cascade delete node with all children
    Given nodes exist:
      | id   | name        | parent |
      | n-1  | System A    | null   |
      | n-2  | Subdomain B | n-1    |
      | n-3  | Context C   | n-2    |
    When I delete node "n-1" with cascade option
    And I confirm the cascade deletion
    Then nodes "n-1", "n-2", "n-3" are deleted
    And the system has 0 nodes

  Scenario: Filter nodes by nodeType
    Given nodes exist:
      | name        | nodeType        |
      | System A    | system          |
      | Subdomain B | subdomain       |
      | Context C   | bounded-context |
    When I filter nodes by nodeType "subdomain"
    Then I see 1 node: "Subdomain B"

  Scenario: Search nodes by tag
    Given nodes exist:
      | name          | tags           |
      | Intelligence  | ai, analysis   |
      | FOE Scanner   | ai, assessment |
      | Web UI        | frontend       |
    When I search nodes by tag "ai"
    Then I see 2 nodes: "Intelligence", "FOE Scanner"
```

## Dependencies

- **CAP-013**: System Taxonomy Management
- **ROAD-041**: Taxonomy CRUD Operations (Phase 1)

## Related Stories

- **US-050**: Define Architectural Layer Standards (depends on nodes existing)
- **US-051**: Map Capabilities to Nodes (depends on nodes existing)

## Technical Notes

### Validation Rules

1. **Name uniqueness**: Within same parent scope only (siblings must be unique)
2. **NodeType immutability**: Cannot change after creation (delete and recreate instead)
3. **Parent validation**: Must exist and not create circular dependency
4. **Cascade delete**: Requires explicit confirmation for safety

### Performance Considerations

- Index nodes by `parentId` for fast hierarchy queries
- Index nodes by `nodeType` for fast filtering
- Cache full hierarchy tree for read-heavy workloads
- Batch validation for bulk imports

### Dual Persistence

- **SQLite adapter**: Operational queries, referential integrity, transactions
- **File adapter**: GitOps workflows, human-readable diffs, version control
- Both adapters must implement same `TaxonomyRepository` port
- Sync tool to keep adapters consistent
