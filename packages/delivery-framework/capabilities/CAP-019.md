---
id: CAP-019
title: "Taxonomy CRUD API"
tag: "@CAP-019"
category: Business
status: stable
description: "Full CRUD operations for all 8 taxonomy entity types with port/adapter pattern supporting database and file persistence."
---

# CAP-019: Taxonomy CRUD API

## Description

The system provides full Create, Read, Update, and Delete (CRUD) operations for all 8 taxonomy entity types: Nodes, Environments, Layer Types, Capabilities, Capability Relationships, Actions, Stages, and Tools. This capability extends the existing taxonomy management system (CAP-013) from read-only snapshot ingestion to a fully mutable API that supports both database-backed and file-backed persistence.

The API follows the port/adapter pattern established by the hexagonal architecture foundation (CAP-020). A `TaxonomyRepository` port interface defines mutation methods (create, update, delete) alongside the existing query methods. Two adapters implement this port: the `DomainModelRepositorySQLite` adapter for production use with transaction support and referential integrity checks, and the `TaxonomyRepositoryFile` adapter for GitOps workflows that reads and writes YAML directory structures.

Referential integrity is enforced at the use-case layer: creating a node validates that its parent reference exists, deleting a node checks for dependent children, and updating a capability relationship validates both source and target capability IDs. This prevents cascading orphans and ensures the taxonomy graph remains consistent.

## Key Features

- **8 Entity Type CRUD**: POST, GET, PUT, DELETE endpoints for Nodes, Environments, Layer Types, Capabilities, Capability Relationships, Actions, Stages, and Tools
- **Referential Integrity**: Validates parent references on create/update, prevents deletion of entities with dependents, returns descriptive error messages identifying blocking references
- **Port Interface**: `TaxonomyRepository` port with `create`, `update`, `delete`, and `findById` methods for each entity type
- **SQLite Adapter**: `DomainModelRepositorySQLite` implementation with Drizzle ORM, transaction support for multi-entity operations, and cascading soft-delete options
- **File Adapter**: `TaxonomyRepositoryFile` reads and writes YAML directory structure (`taxonomy/{entity-type}/{id}.yaml`), enabling GitOps version control workflows
- **Backward Compatible**: Existing snapshot ingestion via `POST /api/taxonomy/snapshot` continues to work alongside the new granular CRUD endpoints

## Architecture

```
REST API Endpoints
    POST   /api/taxonomy/{entityType}
    GET    /api/taxonomy/{entityType}
    GET    /api/taxonomy/{entityType}/:id
    PUT    /api/taxonomy/{entityType}/:id
    DELETE /api/taxonomy/{entityType}/:id
    ↓
Use Cases (Validation + Business Rules)
    ├── CreateTaxonomyEntity  — Validates referential integrity, assigns ID
    ├── UpdateTaxonomyEntity  — Validates references, checks existence
    ├── DeleteTaxonomyEntity  — Checks for dependents, prevents orphans
    └── GetTaxonomyEntity     — Retrieves with optional relationship expansion
    ↓
Port: TaxonomyRepository
    ├── Adapter: DomainModelRepositorySQLite (Drizzle ORM, transactions)
    └── Adapter: TaxonomyRepositoryFile (YAML directory structure)
```

## NFR Requirements

- API latency < 100ms for single-entity CRUD operations
- Referential integrity enforced on all mutations — no orphaned records permitted
- Transaction isolation for multi-entity operations (SQLite adapter)
- Descriptive error responses with HTTP 409 for integrity violations, HTTP 404 for missing entities

## Personas

- **PER-002** (Platform Engineer) — Manages taxonomy entities via REST API, builds automation scripts for bulk taxonomy updates
- **PER-005** (Framework Adopter) — Uses the file adapter for GitOps YAML workflows, version-controlling taxonomy changes alongside code

## Related Capabilities

- **CAP-013** (System Taxonomy Management) — Provides the read-only taxonomy data model that this capability extends with mutation operations
- **CAP-009** (DDD Domain Modeling API) — Shares the hexagonal architecture pattern and SQLite persistence layer

## Related Artifacts

- **User Stories**: US-064 (Taxonomy CRUD Operations)
- **Road Items**: ROAD-041 (Taxonomy CRUD API)
