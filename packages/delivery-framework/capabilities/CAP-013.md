---
id: CAP-013
title: "System Taxonomy Management"
tag: "@CAP-013"
category: Business
status: planned
description: "Manage all taxonomy entity types (nodes, environments, layer types, capabilities, relationships, actions, stages, tools) with full CRUD operations supporting both database persistence and file-based source of truth via port/adapter pattern."
---

# CAP-013: System Taxonomy Management

## Description

The system provides comprehensive management of all taxonomy entity types including nodes (organizational hierarchy), environments (deployment targets), layer types (architectural patterns), capabilities (system features), capability relationships, actions (automation workflows), stages (pipeline steps), and tools. The architecture supports multiple persistence strategies through the port/adapter pattern: database storage for operational queries and file-based source of truth for GitOps workflows. Users can incrementally create, update, and delete taxonomy items rather than requiring full snapshot ingestion.

## Key Features

- **Individual CRUD for All 8 Entity Types**:
  1. **Nodes**: Create, read, update, delete organizational hierarchy items
  2. **Environments**: Manage deployment environments (dev, staging, prod)
  3. **Layer Types**: Define canonical architectural layers (presentation, domain, infrastructure)
  4. **Capabilities**: Manage system feature definitions
  5. **Capability Relationships**: Link capabilities to nodes with relationship types
  6. **Actions**: Define automation workflows (shell, http, workflow)
  7. **Stages**: Manage pipeline stages with dependencies
  8. **Tools**: Define automation tools and their actions
- **Hierarchy Management**: Maintain parent-child relationships with referential integrity validation
- **Dual Persistence**: Port/adapter pattern supporting both database (SQLite) and file-based (YAML/JSON) sources
- **Incremental Updates**: Make small changes without regenerating entire taxonomy JSON
- **Snapshot Compatibility**: Maintains backward compatibility with bulk snapshot ingestion workflow
- **Validation**: Zod schema validation for all taxonomy entity types
- **Referential Integrity**: Cross-entity validation (e.g., layer types referenced by actions, capabilities in relationships)

## Port/Adapter Pattern

```
┌──────────────────────────────────────────────────────┐
│                  Use Cases Layer                      │
│  - CreateTaxonomyNode                                 │
│  - UpdateTaxonomyNode                                 │
│  - DeleteTaxonomyNode                                 │
│  - QueryTaxonomyHierarchy                             │
└────────────────┬─────────────────────────────────────┘
                 │
                 ▼
┌──────────────────────────────────────────────────────┐
│              TaxonomyRepository (Port)                │
│  Interface defining all persistence operations        │
└────────────────┬─────────────────────────────────────┘
                 │
        ┌────────┴────────┐
        ▼                 ▼
┌──────────────────┐  ┌──────────────────┐
│ SQLite Adapter   │  │ File Adapter     │
│ - Fast queries   │  │ - GitOps source  │
│ - Denormalized   │  │ - YAML/JSON      │
│ - API optimized  │  │ - CI pipelines   │
└──────────────────┘  └──────────────────┘
```

## Persistence Strategies

### Database Adapter (TaxonomyRepositorySQLite)
- **Use Case**: Operational queries, API responses, web UI
- **Strengths**: Fast queries, denormalized views, transaction support
- **Trade-offs**: Requires migration for schema changes

### File Adapter (TaxonomyRepositoryFile)
- **Use Case**: GitOps workflows, external tool integration, version control
- **Strengths**: Human-readable, version controllable, easy to edit
- **Trade-offs**: Slower queries, must parse on each read

## NFR Requirements

- **NFR-PERF-001**: Individual node CRUD operations must complete in &lt;200ms
- **NFR-PERF-002**: Hierarchy queries must return &lt;2s for taxonomies with &lt;500 nodes
- **NFR-SEC-001**: All mutations require authentication and authorization
- **NFR-A11Y-001**: Web UI forms must be WCAG 2.1 AA compliant

## Personas

- **PER-001** (Engineering Team Lead) — Adds new systems/subsystems as teams grow
- **PER-002** (Platform Engineer) — Manages environments and capability mappings
- **PER-005** (Framework Adopter) — Extends taxonomy to match organizational structure
- **PER-006** (API Consumer) — Integrates taxonomy data into external tools

## Related Capabilities

- **CAP-002** (Governance Validation) — Validates capability references in taxonomy
- **CAP-009** (DDD Domain Modeling API) — Similar CRUD pattern for domain artifacts
- **CAP-010** (Interactive Domain Visualization) — Renders taxonomy as interactive diagrams

## Existing Constraints

- Currently only supports snapshot ingestion (POST /api/v1/taxonomy)
- No individual node CRUD operations
- Cannot incrementally update without re-ingesting entire taxonomy
- File adapter does not exist yet (only SQLite adapter implemented)
