---
id: CAP-014
title: "FOE Report Trend Analysis & History"
tag: "@CAP-014"
category: Business
status: planned
description: "Visualize FOE report history, track score trends over time, compare multiple reports, and analyze maturity progression for continuous improvement insights."
---

# CAP-014: FOE Report Trend Analysis & History

## Description

The system provides comprehensive trend analysis and historical tracking of FOE scan reports. Users can visualize score progression over time, compare multiple reports side-by-side, track maturity level changes, and identify patterns in gap resolution. This enables data-driven decision making for continuous improvement initiatives.

## Key Features

- **Score Trend Visualization**: Line charts showing overall score and dimension scores (Feedback, Understanding, Confidence) over time
- **Report History Table**: Chronological list of all scans with dates, scores, and maturity levels
- **Side-by-Side Comparison**: Compare two reports with delta calculations for scores, gaps, and strengths
- **Maturity Timeline**: Visual timeline showing progression through maturity stages (Hypothesized → Emerging → Practicing → Optimized)
- **Gap Resolution Tracking**: Track which gaps were resolved between scans
- **Strength Evolution**: Monitor new strengths acquired over time
- **Repository Dashboard**: Aggregate view showing latest score, scan count, and trend direction
- **Export Capabilities**: Download trend data as CSV or JSON for external analysis

## Architecture

```
Web UI (React + Recharts)
    ↓
GET /api/v1/repositories/:id/trend
GET /api/v1/reports?repositoryId=:id
    ↓
ReportRepository (Port)
    ↓
ReportRepositorySQLite (Adapter)
    ↓
SQLite Database
    - repositories table
    - scans table (multiple per repository)
    - dimensions table
    - findings table
```

**Status**: Backend API complete, Web UI visualization components needed

## Backend API (Already Exists) ✅

### Get Score Trend
```http
GET /api/v1/repositories/:id/trend

Response:
{
  "repository": { "id": "uuid", "name": "katalyst-domain-mapper" },
  "trend": [
    {
      "scanId": "uuid-1",
      "scanDate": "2024-01-15T10:00:00Z",
      "overallScore": 65,
      "feedback": 60,
      "understanding": 70,
      "confidence": 65
    },
    // ... more points
  ]
}
```

### List All Reports
```http
GET /api/v1/reports?repositoryId=:id&limit=10

Response: [
  {
    "id": "uuid",
    "repositoryId": "xyz",
    "repositoryName": "repo-name",
    "overallScore": 72,
    "maturityLevel": "Practicing",
    "scanDate": "2024-02-01T14:30:00Z",
    "createdAt": "2024-02-01T14:35:00Z"
  }
]
```

### Compare Reports (Use Case Exists)
```typescript
// packages/intelligence/api/usecases/report/CompareReports.ts
const comparison = await compareReports.execute(baseId, compareId);

// Returns:
{
  scoreDelta: +7,
  dimensionDeltas: { feedback: +8, understanding: +5, confidence: +8 },
  maturityChange: { from: "Emerging", to: "Practicing" },
  newGaps: ["Test coverage gaps"],
  resolvedGaps: ["Documentation missing"],
  newStrengths: ["CI/CD pipeline"]
}
```

## Web UI Components (To Be Built)

### 1. Trend Page Route
- `/reports/history/:repositoryId` - Full trend analysis view

### 2. React Components
- `<TrendLineChart />` - Multi-line chart with Recharts
- `<ReportHistoryTable />` - Sortable table with date, score, maturity
- `<ComparisonView />` - Side-by-side report comparison
- `<MaturityTimeline />` - Visual progression through stages
- `<GapResolutionTracker />` - Shows resolved vs new gaps
- `<RepositoryDashboard />` - Overview with latest stats + trend sparkline

### 3. UI Features
- **Date Range Selector**: Filter trends by date range (last 30 days, 90 days, 1 year)
- **Dimension Toggle**: Show/hide individual dimension trend lines
- **Hover Tooltips**: Detailed info on hover over chart points
- **Export Button**: Download trend data as CSV
- **Comparison Selector**: Choose two reports from dropdown
- **Responsive Design**: Mobile-friendly layouts

## NFR Requirements

- **NFR-PERF-002**: Trend page loads in <2s with up to 50 data points
- **NFR-A11Y-001**: Charts have ARIA labels, keyboard navigation, screen reader support
- **NFR-SEC-001**: Report history respects repository-level access controls

## Personas

- **PER-001** (Engineering Team Lead) — Primary user for tracking improvement
- **PER-002** (Platform Engineer) — Monitors organizational maturity trends
- **PER-005** (Framework Adopter) — Demonstrates value to leadership with trend data
- **PER-006** (Non-Technical Stakeholder) — Views high-level maturity progression

## Related Capabilities

- **CAP-001** (FOE Report Generation) — Generates the reports being tracked
- **CAP-004** (Repository Scanning) — Triggers new scans that add to history
- **CAP-009** (DDD Domain Modeling API) — Similar pattern for API-backed CRUD with history

## Existing Implementation

### Backend: Complete ✅
- `ReportRepository.getScoreTrend()` - Implemented in SQLite adapter
- `CompareReports` use case - Full comparison logic
- `ListReports` use case - Filtering by repositoryId
- HTTP routes: `/repositories/:id/trend`, `/reports`

### Frontend: Not Started ❌
- No trend visualization components
- No report history page
- No comparison UI
- Basic single-report view exists

## Dependencies

- **Recharts** (already in project) - For line charts, area charts
- **TanStack Query** (React Query) - Data fetching and caching
- **date-fns** or **Day.js** - Date formatting and manipulation
- **Tailwind CSS** (already in project) - Styling

## User Stories

- **US-030** (Compare FOE Reports) — Existing, needs UI implementation
- **US-047** (View FOE Score Trends Over Time) — New story for trend visualization
- **US-048** (Track Maturity Level Progression) — New story for maturity timeline
- **US-031** (Filter and Paginate Report Listings) — Existing, partial implementation
