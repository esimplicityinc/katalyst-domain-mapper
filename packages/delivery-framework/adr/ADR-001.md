---
id: ADR-001
title: "Bun Workspaces as Package Manager and Runtime"
status: accepted
category: infrastructure
scope: project-wide
created: "2026-02-06"
updated: "2026-02-06"
author: "Katalyst Team"
supersedes: ""
superseded_by: ""
---

# ADR-001: Bun Workspaces as Package Manager and Runtime

## Status

**Accepted** - 2026-02-06

## Context

The Katalyst Domain Mapper is a monorepo with 7 packages (`@foe/schemas`, `@foe/field-guide-tools`, `@foe/scanner`, `@foe/api`, `@foe/web-ui`, `@foe/web-report`, `@foe/delivery-framework`). The project needs:

- A monorepo workspace manager that handles inter-package dependencies
- A fast package installer (frequent CI runs, large dependency trees)
- A runtime that natively supports TypeScript without a separate compilation step
- A build tool for bundling library packages

Traditional Node.js tooling (npm/yarn + tsc + esbuild/rollup) introduces significant configuration overhead and slower install/build times for a project of this scope.

## Decision

Use **Bun** as the unified runtime, package manager, and build tool across all packages. Use Bun's native workspace support (`"workspaces"` in root `package.json`) for monorepo management.

Key aspects:
- `bun install` for dependency resolution (lockfile: `bun.lock`)
- `bun run` for script execution
- `bun build` for library bundling (`@foe/schemas` outputs 141KB bundle + 45 declaration files)
- `bun test` for unit testing where applicable
- Native TypeScript execution (no `tsc` compilation step for development)

## Consequences

### Positive

- Install times are 5-10x faster than npm, reducing CI pipeline duration
- Native TypeScript support eliminates the compilation step for development and scripts
- Single tool replaces npm/yarn + tsc + esbuild, reducing configuration surface area
- Workspace resolution is built-in with no additional tooling (no Lerna, Turborepo, or Nx)
- `bun:sqlite` driver available for the API package (ADR-004)

### Negative

- Bun is less mature than Node.js; some edge cases in module resolution may differ
- Team members must install Bun locally (not pre-installed on most systems)
- Some npm packages with native addons may not work identically under Bun
- Docker base images use `oven/bun:1` which is less widely cached than `node:` images

### Neutral

- Bun's lockfile format (`bun.lock`) differs from `package-lock.json` and `yarn.lock`
- The project can still run most scripts under Node.js if needed (Bun is largely Node-compatible)

## Alternatives Considered

### Alternative 1: npm Workspaces

**Description**: Use npm 7+ native workspaces with Node.js runtime.

**Pros**:
- Zero additional tooling; npm ships with Node.js
- Widest ecosystem compatibility

**Cons**:
- Slower install and script execution
- Requires separate TypeScript compilation step
- No built-in bundler

**Why Rejected**: Significantly slower development cycle and more configuration overhead for the same monorepo structure.

### Alternative 2: pnpm + Turborepo

**Description**: Use pnpm for fast, disk-efficient package management with Turborepo for task orchestration.

**Pros**:
- pnpm is fast and disk-efficient (symlinked node_modules)
- Turborepo provides intelligent caching and parallel task execution

**Cons**:
- Two tools to configure and maintain instead of one
- Still requires Node.js + tsc for TypeScript
- Turborepo adds complexity for a monorepo of this size (7 packages, not 70)

**Why Rejected**: Over-engineering for the current project scale. Bun provides sufficient performance with less configuration.

### Alternative 3: Yarn Berry (PnP)

**Description**: Use Yarn 4 with Plug'n'Play for zero-install workflows.

**Pros**:
- Zero-install possible (commit node_modules as zip)
- Strict dependency resolution

**Cons**:
- PnP mode breaks many tools that expect `node_modules/`
- Steeper learning curve
- Still requires Node.js runtime

**Why Rejected**: PnP compatibility issues with Docusaurus, Playwright, and other dependencies outweigh the zero-install benefit.

## Implementation Notes

- Root `package.json` declares workspaces: `["packages/*"]`
- Each package has its own `package.json` with workspace dependencies (e.g., `"@foe/schemas": "workspace:*"`)
- CI uses `oven/bun:1` Docker image for consistent builds
- The unified container (`Dockerfile` at root) uses multi-stage builds starting from `oven/bun:1`

## References

- [Bun Workspaces Documentation](https://bun.sh/docs/install/workspaces)
- [Root package.json](../../package.json)
- [Dockerfile](../../Dockerfile)

## Compliance

This ADR affects the following areas:
- **Road Items**: ROAD-001, ROAD-002, ROAD-003, ROAD-004
- **NFRs**: NFR-PERF-001
- **BDD Scenarios**: N/A (infrastructure decision)

---

**Template Version**: 1.0.0
**Last Updated**: 2026-02-06
