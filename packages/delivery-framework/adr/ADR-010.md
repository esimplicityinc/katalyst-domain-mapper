---
id: ADR-010
title: "Progressive Replacement Strategy for Legacy Scripts"
status: accepted
category: architecture
scope: "packages/delivery-framework"
created: "2026-02-06"
updated: "2026-02-06"
author: "Katalyst Team"
supersedes: ""
superseded_by: ""
---

# ADR-010: Progressive Replacement Strategy for Legacy Scripts

## Status

**Accepted** - 2026-02-06

## Context

The delivery framework was imported from `prima-delivery-demonstrator` with 6 hand-written JavaScript governance scripts (~1,500 lines total):

- `governance-linter.js` - Validates governance artifact frontmatter and cross-references
- `validate-changes.js` - Checks change entry compliance
- `validate-bdd-tags.js` - Validates BDD tag conventions
- `capability-coverage-report.js` - Reports capability coverage across road items
- `persona-coverage-report.js` - Reports persona coverage across user stories
- `validate-docs.js` - General documentation validation

These scripts are the existing "old system" that currently enforces governance rules. The new system (Zod schemas + parsers + CLI in ROAD-002/003/004) will replace them with a type-safe, schema-validated pipeline. The question is: how to migrate from old to new without a risky big-bang cutover?

## Decision

Use a **progressive replacement strategy** where old and new systems run in parallel during the transition period. The old scripts serve as the **test oracle** -- the new system must produce equivalent results before the old system is removed.

**Migration phases:**

| Release | Old System | New System | Relationship |
|---------|-----------|------------|-------------|
| 0.1.0 | All old scripts running | Schemas exist only | Independent |
| 0.2.0 | All old scripts running | Zod schemas available | Schemas validated against old script expectations |
| 0.3.0 | Old scripts + new CLI both run in CI | CLI produces governance-index.json | Both run; outputs compared |
| 0.4.0 | Old scripts still available | API ingests governance index | API is additive |
| 0.5.0 | Old plugins replaced | Docusaurus consumes governance-index.json | Plugins migrated |
| 0.6.0 | **Deleted** | New system is sole authority | Old scripts removed |

**Key principles:**
1. The old system is the test oracle until deleted
2. Agents are the canary (if agents can create valid artifacts using new tooling, the migration works)
3. Progressive, not big-bang (each release replaces one piece)
4. Both systems coexist during transition

## Consequences

### Positive

- Zero-risk migration: old system validates that new system produces equivalent results
- Each release is independently deployable and testable
- Rollback is trivial: revert to previous release with old scripts still intact
- Agent validation at each step confirms the migration doesn't break the workflow
- Old scripts provide a regression test suite for the new implementation

### Negative

- Maintaining two systems in parallel increases complexity during the transition period
- CI pipeline runs both old and new validation, increasing build time
- Team must understand both systems during the transition
- The migration spans multiple releases (0.2.0 through 0.6.0), requiring sustained focus

### Neutral

- The Justfile recipes abstract the choice of old vs. new system from developers
- The transition period is bounded (5 releases, estimated 3-4 weeks)
- Old scripts are marked as deprecated (not deleted) until the final cutover release

## Alternatives Considered

### Alternative 1: Big-Bang Replacement

**Description**: Delete old scripts, deploy new system in a single release.

**Pros**:
- Clean cutover, no transition period
- No need to maintain two systems

**Cons**:
- High risk: if the new system has bugs, governance validation is broken
- No safety net: cannot compare old vs. new output
- All-or-nothing: partial rollback is impossible

**Why Rejected**: The governance system is critical infrastructure. A big-bang replacement risks leaving the project without functioning governance validation if the new system has issues.

### Alternative 2: Rewrite Old Scripts in TypeScript

**Description**: Modernize the existing scripts by rewriting them in TypeScript, keeping the same architecture.

**Pros**:
- Type safety for existing scripts
- Familiar architecture (same validation approach)
- Lower risk than a full replacement

**Cons**:
- Doesn't solve the fundamental issue (hand-written validation vs. schema-driven)
- Still no Zod integration (types and validators remain separate)
- Maintenance burden remains (custom code vs. declarative schemas)
- Doesn't enable the API/scanner integration

**Why Rejected**: Rewriting achieves TypeScript types but doesn't deliver the schema-driven architecture needed for API ingestion, scanner integration, and web visualization.

### Alternative 3: Keep Old Scripts Permanently

**Description**: Run old scripts alongside the new system indefinitely as a secondary check.

**Pros**:
- Maximum safety: always have a fallback
- Two independent validation systems catch different issues

**Cons**:
- Permanent maintenance burden for deprecated code
- Confusion about which system is authoritative
- Old scripts cannot evolve with new governance features
- Increases CI build time permanently

**Why Rejected**: The old scripts will become increasingly divergent from the new system as features are added. Keeping them permanently creates technical debt without proportional benefit.

## Implementation Notes

- Justfile recipes abstract old/new: `just governance-lint` calls old scripts initially, then new CLI
- CI pipeline runs both during transition: `just governance-lint && bunx foe-field-guide validate:governance`
- Output comparison script diffs old validation results against new CLI output
- ROAD-008 explicitly tracks the migration progress
- Release 0.6.0 is the "delete old scripts" release with a dedicated PR

## References

- [Master Plan - Progressive Release Path](../plans/master-plan.md)
- [Old Governance Scripts](../scripts/)
- [Parsers Plan (New System)](../plans/parsers-and-builders.md)
- [ROAD-008: Delivery Framework Integration](../roads/ROAD-008.md)

## Compliance

This ADR affects the following areas:
- **Road Items**: ROAD-008
- **NFRs**: NFR-MAINT-001 (Cross-Reference Referential Integrity must be maintained during migration)
- **BDD Scenarios**: Governance e2e feature files validating old/new system parity

---

**Template Version**: 1.0.0
**Last Updated**: 2026-02-06
